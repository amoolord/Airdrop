<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Ø¬Ù†Ú¯ Ø¬Ù‡Ø§Ù†ÛŒ: Ù†Ø¨Ø±Ø¯ Ù†Ù‡Ø§ÛŒÛŒ</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Naskh+Arabic:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
      touch-action: manipulation;
      font-family: 'Noto Naskh Arabic', 'Segoe UI', sans-serif;
    }
    
    body {
      background: #0a0a1a;
      color: white;
      overflow: hidden;
      touch-action: none;
    }
    
    /* Ø§Ø³ØªØ§ÛŒÙ„ Ù…Ù†Ùˆ Ø§ØµÙ„ÛŒ */
    #mainMenu {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at center, #0f2027 0%, #203a43 50%, #2c5364 100%);
      z-index: 100;
      padding: 20px;
      text-align: center;
      transition: all 0.5s ease;
    }
    
    .logo {
      font-size: 2.8rem;
      margin-bottom: 20px;
      color: #00e5ff;
      text-shadow: 0 0 15px rgba(0, 229, 255, 0.7);
      animation: glow 2s infinite alternate;
    }
    
    @keyframes glow {
      from { text-shadow: 0 0 10px rgba(0, 229, 255, 0.7); }
      to { text-shadow: 0 0 20px rgba(0, 229, 255, 1), 0 0 30px rgba(0, 150, 255, 0.7); }
    }
    
    .menu-subtitle {
      font-size: 1.2rem;
      margin-bottom: 30px;
      opacity: 0.8;
    }
    
    .menu-btn {
      background: linear-gradient(135deg, #00c6ff, #0072ff);
      color: white;
      border: none;
      border-radius: 25px;
      padding: 15px 30px;
      margin: 10px 0;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      width: 80%;
      max-width: 300px;
      box-shadow: 0 5px 15px rgba(0, 114, 255, 0.3);
      transition: all 0.3s;
    }
    
    .menu-btn:hover, .menu-btn:active {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 114, 255, 0.4);
    }
    
    .menu-btn.secondary {
      background: linear-gradient(135deg, #6a11cb, #2575fc);
    }
    
    /* Ø§Ø³ØªØ§ÛŒÙ„ Ù…Ù†Ùˆ ØªÙ†Ø¸ÛŒÙ…Ø§Øª */
    .settings-panel {
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 20px;
      width: 90%;
      max-width: 500px;
      margin-top: 20px;
      display: none;
    }
    
    .settings-panel h3 {
      margin-bottom: 15px;
      color: #00e5ff;
    }
    
    .input-group {
      margin-bottom: 15px;
      text-align: right;
    }
    
    .input-group label {
      display: block;
      margin-bottom: 5px;
      font-size: 0.9rem;
    }
    
    .input-group input, .input-group select {
      width: 100%;
      padding: 12px 15px;
      border-radius: 12px;
      border: 1px solid #444;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 1rem;
    }
    
    /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¨Ø§Ø²ÛŒ */
    #gameContainer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      display: none;
    }
    
    #worldMap {
      position: absolute;
      top: 0;
      left: 0;
      width: 2000px;
      height: 1000px;
      background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/8/80/World_map_-_low_resolution.svg/1200px-World_map_-_low_resolution.svg.png');
      background-size: cover;
      background-position: center;
      opacity: 0.7;
    }
    
    #gameCanvas {
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
      z-index: 2;
    }
    
    .country {
  position: absolute;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.8rem;
  cursor: pointer;
  transition: all 0.3s;
  z-index: 3;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  transform: translate(-50%, -50%); /* Ø§ÛŒÙ† Ø®Ø· Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯ */
}
    
    .country:hover {
      transform: scale(1.1);
    }
    
    .country-name {
      position: absolute;
      bottom: -25px;
      font-size: 0.9rem;
      font-weight: bold;
      text-shadow: 1px 1px 3px black;
      white-space: nowrap;
    }
    
    .hp-bar {
      position: absolute;
      width: 60px;
      height: 8px;
      background: rgba(255, 0, 0, 0.5);
      border-radius: 4px;
      bottom: -40px;
      overflow: hidden;
    }
    
    .hp-fill {
      height: 100%;
      background: linear-gradient(90deg, #00c853, #5efc82);
      width: 100%;
      transition: width 0.3s;
    }
    
    /* Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§Ø²ÛŒ */
    #gameUI {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      padding: 15px;
      z-index: 10;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      display: none;
    }
    
    .player-info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
    }
    
    .player-stats {
      display: flex;
      gap: 15px;
    }
    
    .stat {
      background: rgba(255, 255, 255, 0.1);
      padding: 8px 12px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .stat.money {
      color: gold;
    }
    
    .stat.health {
      color: #ff5252;
    }
    
    .stat.defense {
      color: #40c4ff;
    }
    
    #actionPanel {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .action-btn {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 12px;
      padding: 12px 5px;
      color: white;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
    }
    
    .action-btn:hover, .action-btn.active {
      background: rgba(0, 150, 255, 0.3);
      transform: scale(1.05);
    }
    
    .action-btn .icon {
      font-size: 1.4rem;
    }
    
    .action-btn .cost {
      color: gold;
      font-size: 0.8rem;
    }
    
    #chatBox {
      background: rgba(0, 0, 0, 0.5);
      border-radius: 12px;
      padding: 10px;
      max-height: 120px;
      overflow-y: auto;
    }
    
    #messages {
      display: flex;
      flex-direction: column;
      gap: 5px;
      font-size: 0.9rem;
    }
    
    .message {
      background: rgba(255, 255, 255, 0.1);
      padding: 8px 12px;
      border-radius: 8px;
      animation: fadeIn 0.3s;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    #chatInput {
      width: 100%;
      padding: 10px 15px;
      margin-top: 10px;
      border-radius: 12px;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 0.9rem;
    }
    
    /* Ø§Ù†ÛŒÙ…ÛŒØ´Ù†â€ŒÙ‡Ø§ Ùˆ Ø§ÙÚ©Øªâ€ŒÙ‡Ø§ */
    .explosion {
      position: absolute;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,200,0,0.8) 0%, rgba(255,100,0,0.6) 50%, rgba(255,0,0,0) 100%);
      transform: translate(-50%, -50%);
      z-index: 4;
      animation: explode 0.8s forwards;
    }
    
    @keyframes explode {
      0% { width: 0; height: 0; opacity: 1; }
      100% { width: 200px; height: 200px; opacity: 0; }
    }
    
    .alliance-glow {
      animation: allianceGlow 2s infinite alternate;
    }
    
    @keyframes allianceGlow {
      from { box-shadow: 0 0 10px rgba(0, 255, 255, 0.5); }
      to { box-shadow: 0 0 20px rgba(0, 255, 255, 0.8), 0 0 30px rgba(0, 150, 255, 0.5); }
    }
    
    /* ØµÙØ­Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ */
    #gameOver {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 20;
      display: none;
    }
    
    #gameOver h2 {
      font-size: 2.5rem;
      margin-bottom: 20px;
      color: #ff5252;
    }
    
    #gameOver p {
      font-size: 1.2rem;
      margin-bottom: 30px;
      text-align: center;
      max-width: 80%;
    }
    
    /* Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ø§Ø± Ø³ÙØ§Ø±Ø´ÛŒ */
    ::-webkit-scrollbar {
      width: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 3px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 3px;
    }
    
    /* Ø±Ø³Ù¾Ø§Ù†Ø³ÛŒÙˆ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ */
    @media (max-width: 768px) {
      .logo {
        font-size: 2rem;
      }
      
      .menu-subtitle {
        font-size: 1rem;
      }
      
      .menu-btn {
        padding: 12px 20px;
        font-size: 1rem;
      }
      
      #actionPanel {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .country {
        width: 50px;
        height: 50px;
        font-size: 1.8rem;
      }
      
      .country-name {
        font-size: 0.7rem;
        bottom: -20px;
      }
      
      .hp-bar {
        width: 40px;
        height: 6px;
        bottom: -30px;
      }
    }
  </style>
</head>
<body>

  <!-- Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ -->
  <div id="mainMenu">
    <div class="logo">ğŸŒ Ø¬Ù†Ú¯ Ø¬Ù‡Ø§Ù†ÛŒ: Ù†Ø¨Ø±Ø¯ Ù†Ù‡Ø§ÛŒÛŒ</div>
    <p class="menu-subtitle">Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒØŒ Ø§ØªØ­Ø§Ø¯ØŒ Ù¾ÛŒØ±ÙˆØ²ÛŒ - Ø¬Ù‡Ø§Ù† Ø¯Ø± Ø¯Ø³ØªØ§Ù† Ø´Ù…Ø§Ø³Øª</p>
    
    <button class="menu-btn" onclick="showSettings('single')">Ø¨Ø§Ø²ÛŒ ØªÚ© Ù†ÙØ±Ù‡</button>
    <button class="menu-btn secondary" onclick="showSettings('multi')">Ø¨Ø§Ø²ÛŒ Ú†Ù†Ø¯Ù†ÙØ±Ù‡</button>
    <button class="menu-btn" onclick="showTutorial()">Ø¢Ù…ÙˆØ²Ø´ Ø¨Ø§Ø²ÛŒ</button>
    
    <div id="singlePlayerSettings" class="settings-panel">
      <h3>ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§Ø²ÛŒ ØªÚ© Ù†ÙØ±Ù‡</h3>
      <div class="input-group">
        <label for="spPlayerName">Ù†Ø§Ù… Ø´Ù…Ø§</label>
        <input type="text" id="spPlayerName" placeholder="Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù†" value="Ø§ÛŒØ±Ø§Ù†">
      </div>
      <div class="input-group">
        <label for="spDifficulty">Ø³Ø·Ø­ Ø¯Ø´ÙˆØ§Ø±ÛŒ</label>
        <select id="spDifficulty">
          <option value="easy">Ø¢Ø³Ø§Ù†</option>
          <option value="medium" selected>Ù…ØªÙˆØ³Ø·</option>
          <option value="hard">Ø³Ø®Øª</option>
        </select>
      </div>
      <button class="menu-btn" onclick="startGame('single')">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</button>
    </div>
    
    <div id="multiPlayerSettings" class="settings-panel">
      <h3>ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§Ø²ÛŒ Ú†Ù†Ø¯Ù†ÙØ±Ù‡</h3>
      <div class="input-group">
        <label for="mpPlayerName">Ù†Ø§Ù… Ø´Ù…Ø§</label>
        <input type="text" id="mpPlayerName" placeholder="Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù†" value="Ø§ÛŒØ±Ø§Ù†">
      </div>
      <div class="input-group">
        <label for="mpRoomCode">Ú©Ø¯ Ø§ØªØ§Ù‚ (Ø¨Ø±Ø§ÛŒ Ù¾ÛŒÙˆØ³ØªÙ†)</label>
        <input type="text" id="mpRoomCode" placeholder="Ø§Ø®ØªÛŒØ§Ø±ÛŒ">
      </div>
      <button class="menu-btn" onclick="startGame('multi')">Ø§ÛŒØ¬Ø§Ø¯ Ø§ØªØ§Ù‚</button>
      <button class="menu-btn secondary" onclick="joinRoom()">Ù¾ÛŒÙˆØ³ØªÙ† Ø¨Ù‡ Ø§ØªØ§Ù‚</button>
    </div>
  </div>

  <!-- ØµÙØ­Ù‡ Ø¨Ø§Ø²ÛŒ -->
  <div id="gameContainer">
    <div id="worldMap"></div>
    <canvas id="gameCanvas"></canvas>
    
    <!-- Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§Ø²ÛŒ -->
    <div id="gameUI">
      <div class="player-info">
        <div class="player-stats">
          <div class="stat money">ğŸ’° <span id="moneyValue">150</span></div>
          <div class="stat health">â¤ï¸ <span id="healthValue">100</span></div>
          <div class="stat defense">ğŸ›¡ï¸ <span id="defenseValue">0</span></div>
        </div>
        <button id="endTurnBtn" style="display:none;">Ø§ØªÙ…Ø§Ù… Ù†ÙˆØ¨Øª</button>
      </div>
      
      <div id="actionPanel"></div>
      
      <div id="chatBox">
        <div id="messages"></div>
        <input type="text" id="chatInput" placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..." />
      </div>
    </div>
  </div>
  
  <!-- ØµÙØ­Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ -->
  <div id="gameOver">
    <h2 id="gameResult">Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ!</h2>
    <p id="gameSummary">Ø´Ù…Ø§ Ø¬Ù‡Ø§Ù† Ø±Ø§ ÙØªØ­ Ú©Ø±Ø¯ÛŒØ¯!</p>
    <button class="menu-btn" onclick="returnToMenu()">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†Ùˆ</button>
  </div>

  <script>
    // --- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§Ø²ÛŒ ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const worldMap = document.getElementById('worldMap');
    const gameContainer = document.getElementById('gameContainer');
    
    // ØªÙ†Ø¸ÛŒÙ… Ø§Ù†Ø¯Ø§Ø²Ù‡ Ú©Ø§Ù†ÙˆØ§Ø³
    function resizeCanvas() {
      canvas.width = gameContainer.clientWidth;
      canvas.height = gameContainer.clientHeight;
      worldMap.style.width = canvas.width * 2 + 'px';
      worldMap.style.height = canvas.height * 2 + 'px';
    }
    
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();
    
    // --- Ú©Ø´ÙˆØ±Ù‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ ---
    const COUNTRIES = [
  { name: "Ø§ÛŒØ±Ø§Ù†", flag: "ğŸ‡®ğŸ‡·", color: "#27ae60", x: 65, y: 45, capital: "ØªÙ‡Ø±Ø§Ù†" },
  { name: "Ø¢Ù…Ø±ÛŒÚ©Ø§", flag: "ğŸ‡ºğŸ‡¸", color: "#3498db", x: 20, y: 40, capital: "ÙˆØ§Ø´Ù†Ú¯ØªÙ†" },
  { name: "Ø±ÙˆØ³ÛŒÙ‡", flag: "ğŸ‡·ğŸ‡º", color: "#c0392b", x: 70, y: 25, capital: "Ù…Ø³Ú©Ùˆ" },
  { name: "Ú†ÛŒÙ†", flag: "ğŸ‡¨ğŸ‡³", color: "#f39c12", x: 80, y: 45, capital: "Ù¾Ú©Ù†" },
  { name: "ÙØ±Ø§Ù†Ø³Ù‡", flag: "ğŸ‡«ğŸ‡·", color: "#8e44ad", x: 48, y: 38, capital: "Ù¾Ø§Ø±ÛŒØ³" },
  { name: "Ø¢Ù„Ù…Ø§Ù†", flag: "ğŸ‡©ğŸ‡ª", color: "#e67e22", x: 50, y: 35, capital: "Ø¨Ø±Ù„ÛŒÙ†" },
  { name: "Ø§Ù†Ú¯Ù„ÛŒØ³", flag: "ğŸ‡¬ğŸ‡§", color: "#1abc9c", x: 45, y: 30, capital: "Ù„Ù†Ø¯Ù†" },
  { name: "ØªØ±Ú©ÛŒÙ‡", flag: "ğŸ‡¹ğŸ‡·", color: "#9b59b6", x: 55, y: 40, capital: "Ø¢Ù†Ú©Ø§Ø±Ø§" },
  { name: "Ù‡Ù†Ø¯", flag: "ğŸ‡®ğŸ‡³", color: "#2ecc71", x: 75, y: 55, capital: "Ø¯Ù‡Ù„ÛŒ" },
  { name: "Ú˜Ø§Ù¾Ù†", flag: "ğŸ‡¯ğŸ‡µ", color: "#e74c3c", x: 90, y: 40, capital: "ØªÙˆÚ©ÛŒÙˆ" },
  { name: "Ø¨Ø±Ø²ÛŒÙ„", flag: "ğŸ‡§ğŸ‡·", color: "#2ecc71", x: 35, y: 70, capital: "Ø¨Ø±Ø§Ø²ÛŒÙ„ÛŒØ§" },
  { name: "Ø§Ø³ØªØ±Ø§Ù„ÛŒØ§", flag: "ğŸ‡¦ğŸ‡º", color: "#1abc9c", x: 85, y: 75, capital: "Ú©Ø§Ù†Ø¨Ø±Ø§" },
  { name: "Ú©Ø§Ù†Ø§Ø¯Ø§", flag: "ğŸ‡¨ğŸ‡¦", color: "#e74c3c", x: 25, y: 30, capital: "Ø§ØªØ§ÙˆØ§" },
  { name: "Ù…Ú©Ø²ÛŒÚ©", flag: "ğŸ‡²ğŸ‡½", color: "#f39c12", x: 15, y: 50, capital: "Ù…Ú©Ø²ÛŒÚ©Ùˆ Ø³ÛŒØªÛŒ" },
  { name: "Ø¢ÙØ±ÛŒÙ‚Ø§ÛŒ Ø¬Ù†ÙˆØ¨ÛŒ", flag: "ğŸ‡¿ğŸ‡¦", color: "#3498db", x: 55, y: 80, capital: "Ù¾Ø±ØªÙˆØ±ÛŒØ§" }
];
    
    // --- Ø§Ù†ÙˆØ§Ø¹ ÙˆØ§Ø­Ø¯Ù‡Ø§ÛŒ Ù†Ø¸Ø§Ù…ÛŒ ---
    const UNITS = {
      missile: { cost: 20, damage: [15, 30], icon: "ğŸš€", name: "Ù…ÙˆØ´Ú©", cooldown: 2 },
      tank: { cost: 40, damage: [25, 40], icon: "ğŸ›¡ï¸", name: "ØªØ§Ù†Ú©", cooldown: 3 },
      nuke: { cost: 150, damage: [80, 120], icon: "â˜¢ï¸", name: "Ù‡Ø³ØªÙ‡â€ŒØ§ÛŒ", cooldown: 10 },
      drone: { cost: 60, damage: [20, 30], icon: "ğŸ›¸", name: "Ù¾Ù‡Ù¾Ø§Ø¯", cooldown: 3 },
      bomber: { cost: 100, damage: [50, 80], icon: "âœˆï¸", name: "Ø¨Ù…Ø¨â€ŒØ§ÙÚ©Ù†", cooldown: 5 },
      laser: { cost: 200, damage: [100, 150], icon: "âš¡", name: "Ù„ÛŒØ²Ø±", cooldown: 8 }
    };
    
    // --- Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ ---
    let players = {};
    let localPlayer = null;
    let gameMode = null;
    let missiles = [];
    let explosions = [];
    let particles = [];
    let selectedUnit = 'missile';
    let alliances = [];
    let gameTurn = 0;
    let isPlayerTurn = true;
    let mapOffsetX = 0;
    let mapOffsetY = 0;
    let isDragging = false;
    let lastX, lastY;
    
    // --- ØªÙˆØ§Ø¨Ø¹ Ù…Ù†Ùˆ ---
    function showSettings(mode) {
      document.getElementById('singlePlayerSettings').style.display = 'none';
      document.getElementById('multiPlayerSettings').style.display = 'none';
      
      if (mode === 'single') {
        document.getElementById('singlePlayerSettings').style.display = 'block';
      } else {
        document.getElementById('multiPlayerSettings').style.display = 'block';
      }
    }
    
    function showTutorial() {
      alert("Ø¢Ù…ÙˆØ²Ø´ Ø¨Ø§Ø²ÛŒ:\n\n1. Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ú©Ø´ÙˆØ±Ù‡Ø§ Ø¨Ù‡ Ø¢Ù†Ù‡Ø§ Ø­Ù…Ù„Ù‡ Ú©Ù†ÛŒØ¯\n2. Ø§Ø² Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÛŒÙ† Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†ÙˆØ¹ Ø­Ù…Ù„Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯\n3. Ø¨Ø§ Ø¯ÛŒÚ¯Ø±Ø§Ù† Ø§ØªØ­Ø§Ø¯ ØªØ´Ú©ÛŒÙ„ Ø¯Ù‡ÛŒØ¯\n4. Ø³Ø±Ù…Ø§ÛŒÙ‡ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø§ Ø¯Ù‚Øª Ø®Ø±Ø¬ Ú©Ù†ÛŒØ¯\n5. Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø§Ø²Ù…Ø§Ù†Ø¯Ù‡ Ø¨Ø±Ù†Ø¯Ù‡ Ø§Ø³Øª!");
    }
    
    function startGame(mode) {
      gameMode = mode;
      document.getElementById('mainMenu').style.display = 'none';
      document.getElementById('gameContainer').style.display = 'block';
      document.getElementById('gameUI').style.display = 'flex';
      
      const playerName = mode === 'single' ? 
        document.getElementById('spPlayerName').value || 'Ø§ÛŒØ±Ø§Ù†' : 
        document.getElementById('mpPlayerName').value || 'Ø§ÛŒØ±Ø§Ù†';
      
      // Ø§ÛŒØ¬Ø§Ø¯ Ø¨Ø§Ø²ÛŒÚ©Ù† Ù…Ø­Ù„ÛŒ
      localPlayer = {
        id: 'player1',
        name: playerName,
        country: COUNTRIES[0],
        hp: 100,
        money: 150,
        defense: 0,
        isAI: false,
        units: {...UNITS}
      };
      players[localPlayer.id] = localPlayer;
      
      // Ø­Ø§Ù„Øª ØªÚ© Ù†ÙØ±Ù‡: Ø§ÛŒØ¬Ø§Ø¯ Ø±Ø¨Ø§Øªâ€ŒÙ‡Ø§
      if (mode === 'single') {
        const difficulty = document.getElementById('spDifficulty').value;
        const aiCount = 5; // ØªØ¹Ø¯Ø§Ø¯ Ø±Ø¨Ø§Øªâ€ŒÙ‡Ø§
        
        for (let i = 1; i <= aiCount; i++) {
          const country = COUNTRIES[i % COUNTRIES.length];
          players[`ai_${i}`] = {
            id: `ai_${i}`,
            name: `${country.name} (Ø±Ø¨Ø§Øª)`,
            country: country,
            hp: 100,
            money: difficulty === 'easy' ? 100 : (difficulty === 'hard' ? 200 : 150),
            defense: 0,
            isAI: true,
            difficulty: difficulty,
            lastAction: 0
          };
        }
        
        addMessage("ğŸ¤– Ø±Ø¨Ø§Øªâ€ŒÙ‡Ø§ Ø¢Ù…Ø§Ø¯Ù‡ Ø¬Ù†Ú¯ Ù‡Ø³ØªÙ†Ø¯!");
      } 
      // Ø­Ø§Ù„Øª Ú†Ù†Ø¯Ù†ÙØ±Ù‡: Ø§ÛŒØ¬Ø§Ø¯ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø®Ø§Ù„ÛŒ (Ø¯Ø± Ø¹Ù…Ù„ Ø§Ø² Ø³Ø±ÙˆØ± Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯)
      else {
        addMessage("ğŸ‘‹ Ø¨Ù‡ Ø¨Ø§Ø²ÛŒ Ú†Ù†Ø¯Ù†ÙØ±Ù‡ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!");
        addMessage("Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø¯ÛŒÚ¯Ø±...");
        document.getElementById('endTurnBtn').style.display = 'block';
      }
      
      // Ø§ÛŒØ¬Ø§Ø¯ Ø±Ø§Ø¨Ø· ÙˆØ§Ø­Ø¯Ù‡Ø§
      setupActionPanel();
      
      // Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø´ÙˆØ±Ù‡Ø§ Ø¯Ø± Ù†Ù‚Ø´Ù‡
      renderCountries();
      
      // Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ
      gameLoop();
    }
    
    function joinRoom() {
      const roomCode = document.getElementById('mpRoomCode').value;
      if (!roomCode) {
        alert("Ù„Ø·ÙØ§ Ú©Ø¯ Ø§ØªØ§Ù‚ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");
        return;
      }
      alert(`Ø¯Ø± Ø­Ø§Ù„ Ù¾ÛŒÙˆØ³ØªÙ† Ø¨Ù‡ Ø§ØªØ§Ù‚ ${roomCode}... (Ø§ÛŒÙ† ÛŒÚ© Ø¯Ù…Ùˆ Ø§Ø³Øª)`);
      startGame('multi');
    }
    
    function returnToMenu() {
      document.getElementById('gameOver').style.display = 'none';
      document.getElementById('mainMenu').style.display = 'flex';
      document.getElementById('gameContainer').style.display = 'none';
      resetGame();
    }
    
    function resetGame() {
      players = {};
      missiles = [];
      explosions = [];
      particles = [];
      alliances = [];
      gameTurn = 0;
      document.getElementById('messages').innerHTML = '';
    }
    
    // --- Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§Ø²ÛŒ ---
    function setupActionPanel() {
      const panel = document.getElementById('actionPanel');
      panel.innerHTML = '';
      
      // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ø­Ø¯Ù‡Ø§
      Object.entries(UNITS).forEach(([key, unit]) => {
        const btn = document.createElement('button');
        btn.className = 'action-btn';
        btn.innerHTML = `
          <span class="icon">${unit.icon}</span>
          <span>${unit.name}</span>
          <span class="cost">$${unit.cost}</span>
        `;
        btn.onclick = () => selectUnit(key);
        panel.appendChild(btn);
      });
      
      // Ø¯Ú©Ù…Ù‡ Ø§ØªØ­Ø§Ø¯
      const allianceBtn = document.createElement('button');
      allianceBtn.className = 'action-btn';
      allianceBtn.innerHTML = `
        <span class="icon">ğŸ¤</span>
        <span>Ø§ØªØ­Ø§Ø¯</span>
      `;
      allianceBtn.onclick = proposeAlliance;
      panel.appendChild(allianceBtn);
      
      // Ø¯Ú©Ù…Ù‡ Ø¯ÙØ§Ø¹
      const defenseBtn = document.createElement('button');
      defenseBtn.className = 'action-btn';
      defenseBtn.innerHTML = `
        <span class="icon">ğŸ°</span>
        <span>Ø¯ÙØ§Ø¹</span>
      `;
      defenseBtn.onclick = increaseDefense;
      panel.appendChild(defenseBtn);
    }
    
    function selectUnit(unitType) {
      selectedUnit = unitType;
      // Ø¨Ø±Ø¬Ø³ØªÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
      document.querySelectorAll('#actionPanel .action-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      addMessage(`âœ… ${UNITS[unitType].name} Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯`);
    }
    
    function proposeAlliance() {
      const possibleAllies = Object.values(players).filter(p => 
        p.id !== localPlayer.id && 
        !alliances.some(a => a.includes(p.id) && a.includes(localPlayer.id))
      );
      
      if (possibleAllies.length === 0) {
        addMessage("âŒ Ù‡ÛŒÚ† Ù…ØªØ­Ø¯ Ø¨Ø§Ù„Ù‚ÙˆÙ‡â€ŒØ§ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯");
        return;
      }
      
      const ally = possibleAllies[Math.floor(Math.random() * possibleAllies.length)];
      alliances.push([localPlayer.id, ally.id]);
      addMessage(`ğŸ¤ Ø´Ù…Ø§ Ø¨Ø§ ${ally.name} Ù¾ÛŒÙ…Ø§Ù† Ø§ØªØ­Ø§Ø¯ Ø¨Ø³ØªÛŒØ¯!`);
      
      // Ø¬Ù„ÙˆÙ‡ Ø¨ØµØ±ÛŒ Ø§ØªØ­Ø§Ø¯
      document.querySelectorAll('.country').forEach(el => {
        if (el.dataset.playerId === ally.id) {
          el.classList.add('alliance-glow');
        }
      });
    }
    
    function increaseDefense() {
      if (localPlayer.money < 30) {
        addMessage("âŒ Ø³Ø±Ù…Ø§ÛŒÙ‡ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª!");
        return;
      }
      
      localPlayer.money -= 30;
      localPlayer.defense += 1;
      updatePlayerUI();
      addMessage(`ğŸ›¡ï¸ Ø³Ø·Ø­ Ø¯ÙØ§Ø¹ Ø´Ù…Ø§ Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§ÙØª: ${localPlayer.defense}`);
    }
    
    function endTurn() {
      isPlayerTurn = false;
      document.getElementById('endTurnBtn').disabled = true;
      addMessage("â³ Ù…Ù†ØªØ¸Ø± Ù†ÙˆØ¨Øª Ø¯ÛŒÚ¯Ø± Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†...");
      
      // Ø¯Ø± Ø­Ø§Ù„Øª Ú†Ù†Ø¯Ù†ÙØ±Ù‡ Ø§ÛŒÙ†Ø¬Ø§ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
      // Ø¯Ø± Ø¯Ù…ÙˆØŒ Ø¨Ø¹Ø¯ Ø§Ø² 2 Ø«Ø§Ù†ÛŒÙ‡ Ù†ÙˆØ¨Øª Ø¨Ø§Ø² Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯
      setTimeout(() => {
        isPlayerTurn = true;
        document.getElementById('endTurnBtn').disabled = false;
        gameTurn++;
        localPlayer.money += 20 + Math.floor(Math.random() * 21);
        updatePlayerUI();
        addMessage(`â™Ÿï¸ Ù†ÙˆØ¨Øª ${gameTurn + 1} Ø´Ø±ÙˆØ¹ Ø´Ø¯! +$${20 + Math.floor(Math.random() * 21)}`);
      }, 2000);
    }
    
    function updatePlayerUI() {
      document.getElementById('moneyValue').textContent = localPlayer.money;
      document.getElementById('healthValue').textContent = localPlayer.hp;
      document.getElementById('defenseValue').textContent = localPlayer.defense;
    }
    
    // --- ØªÙˆØ§Ø¨Ø¹ Ø¨Ø§Ø²ÛŒ ---
    function renderCountries() {
      // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ø´ÙˆØ±Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
      document.querySelectorAll('.country').forEach(el => el.remove());
      
      // Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø´ÙˆØ±Ù‡Ø§
      Object.values(players).forEach(player => {
        const countryEl = document.createElement('div');
        countryEl.className = 'country';
        countryEl.style.left = `${player.country.x}%`;
        countryEl.style.top = `${player.country.y}%`;
        countryEl.style.backgroundColor = player.country.color;
        countryEl.dataset.playerId = player.id;
        
        // Ù¾Ø±Ú†Ù…
        countryEl.innerHTML = `
          ${player.country.flag}
          <div class="country-name">${player.name}</div>
          <div class="hp-bar"><div class="hp-fill" style="width: ${player.hp}%"></div></div>
        `;
        
        // Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ú©Ø´ÙˆØ± (Ø­Ù…Ù„Ù‡)
        countryEl.addEventListener('click', (e) => {
          if (!isPlayerTurn || player.id === localPlayer.id) return;
          
          const unit = UNITS[selectedUnit];
          if (localPlayer.money < unit.cost) {
            addMessage(`âŒ Ø³Ø±Ù…Ø§ÛŒÙ‡ Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ ${unit.name} Ù†Ø¯Ø§Ø±ÛŒØ¯!`);
            return;
          }
          
          localPlayer.money -= unit.cost;
          updatePlayerUI();
          
          // Ø§ÛŒØ¬Ø§Ø¯ Ù…ÙˆØ´Ú©
          const fromX = parseInt(document.querySelector(`.country[data-player-id="${localPlayer.id}"]`).style.left);
          const fromY = parseInt(document.querySelector(`.country[data-player-id="${localPlayer.id}"]`).style.top);
          const toX = parseInt(e.currentTarget.style.left);
          const toY = parseInt(e.currentTarget.style.top);
          
          launchMissile(fromX, fromY, toX, toY, player.country.color, selectedUnit, player.id);
          
          addMessage(`ğŸ”¥ Ø´Ù…Ø§ Ø¨Ù‡ ${player.name} Ø­Ù…Ù„Ù‡ Ú©Ø±Ø¯ÛŒØ¯! (${unit.name})`);
        });
        
        worldMap.appendChild(countryEl);
      });
    }
    
    function launchMissile(fromX, fromY, toX, toY, color, type, targetId) {
      const missile = {
        x: fromX,
        y: fromY,
        toX: toX,
        toY: toY,
        color: color,
        type: type,
        targetId: targetId,
        progress: 0,
        speed: 0.005,
        exploded: false
      };
      
      missiles.push(missile);
    }
    
    function createExplosion(x, y, type) {
      const explosion = document.createElement('div');
      explosion.className = 'explosion';
      explosion.style.left = `${x}%`;
      explosion.style.top = `${y}%`;
      
      if (type === 'nuke') {
        explosion.style.background = 'radial-gradient(circle, rgba(255,255,0,0.8) 0%, rgba(255,0,0,0.6) 50%, rgba(0,0,0,0) 100%)';
      }
      
      worldMap.appendChild(explosion);
      explosions.push(explosion);
      
      // Ø­Ø°Ù Ø§Ù†ÙØ¬Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ø² Ù¾Ø§ÛŒØ§Ù† Ø§Ù†ÛŒÙ…ÛŒØ´Ù†
      setTimeout(() => {
        explosion.remove();
        explosions = explosions.filter(e => e !== explosion);
      }, 800);
    }
    
    function addMessage(text) {
      const msgDiv = document.createElement('div');
      msgDiv.className = 'message';
      msgDiv.textContent = text;
      document.getElementById('messages').appendChild(msgDiv);
      document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
    }
    
    // --- Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ---
    function aiTurn() {
      if (gameMode !== 'single') return;
      
      Object.values(players).forEach(player => {
        if (!player.isAI || player.hp <= 0) return;
        
        // ØªØµÙ…ÛŒÙ…â€ŒÚ¯ÛŒØ±ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø·Ø­ Ø¯Ø´ÙˆØ§Ø±ÛŒ
        const decision = Math.random();
        const enemies = Object.values(players).filter(p => !p.isAI && p.hp > 0);
        
        if (enemies.length === 0) return;
        const target = enemies[0];
        
        // Ø§Ø­ØªÙ…Ø§Ù„ Ø­Ù…Ù„Ù‡
        if (decision < 0.6) {
          let unitType;
          const rand = Math.random();
          
          if (rand < 0.4 && player.money >= UNITS.missile.cost) {
            unitType = 'missile';
          } else if (rand < 0.7 && player.money >= UNITS.tank.cost) {
            unitType = 'tank';
          } else if (rand < 0.85 && player.money >= UNITS.drone.cost) {
            unitType = 'drone';
          } else if (player.money >= UNITS.nuke.cost && Math.random() < (player.difficulty === 'hard' ? 0.3 : 0.1)) {
            unitType = 'nuke';
          } else {
            // Ø¯Ø±Ø¢Ù…Ø¯Ø²Ø§ÛŒÛŒ
            player.money += 20 + Math.floor(Math.random() * 30);
            addMessage(`ğŸ’° ${player.name} Ø¯Ø±Ø¢Ù…Ø¯ Ú©Ø³Ø¨ Ú©Ø±Ø¯!`);
            return;
          }
          
          player.money -= UNITS[unitType].cost;
          launchMissile(
            player.country.x, player.country.y,
            target.country.x, target.country.y,
            player.country.color, unitType, target.id
          );
          
          addMessage(`ğŸ¤– ${player.name} Ø¨Ù‡ ${target.name} Ø­Ù…Ù„Ù‡ Ú©Ø±Ø¯! (${UNITS[unitType].name})`);
        } 
        // Ø§Ø­ØªÙ…Ø§Ù„ Ø§ØªØ­Ø§Ø¯
        else if (decision < 0.8 && Math.random() < 0.3) {
          const possibleAllies = Object.values(players).filter(p => 
            p.id !== player.id && 
            !p.isAI && 
            !alliances.some(a => a.includes(p.id) && a.includes(player.id))
          );
          
          if (possibleAllies.length > 0) {
            const ally = possibleAllies[0];
            alliances.push([player.id, ally.id]);
            addMessage(`ğŸ¤ ${player.name} Ùˆ ${ally.name} Ù…ØªØ­Ø¯ Ø´Ø¯Ù†Ø¯!`);
          }
        }
        // Ø§Ø­ØªÙ…Ø§Ù„ Ø§ÙØ²Ø§ÛŒØ´ Ø¯ÙØ§Ø¹
        else if (player.money >= 30 && Math.random() < 0.4) {
          player.money -= 30;
          player.defense += 1;
          addMessage(`ğŸ›¡ï¸ ${player.name} Ø¯ÙØ§Ø¹ Ø®ÙˆØ¯ Ø±Ø§ ØªÙ‚ÙˆÛŒØª Ú©Ø±Ø¯!`);
        }
      });
    }
    
    // --- Ø­Ù„Ù‚Ù‡ Ø§ØµÙ„ÛŒ Ø¨Ø§Ø²ÛŒ ---
    function gameLoop() {
      // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆØ´Ú©â€ŒÙ‡Ø§
      missiles.forEach(missile => {
        if (missile.exploded) return;
        
        missile.progress += missile.speed;
        if (missile.progress >= 1) {
          missile.exploded = true;
          missile.progress = 1;
          
          // Ø§Ø¹Ù…Ø§Ù„ Ø¢Ø³ÛŒØ¨ Ø¨Ù‡ Ù‡Ø¯Ù
          const target = players[missile.targetId];
          if (target) {
            const unit = UNITS[missile.type];
            const damage = Math.floor(unit.damage[0] + Math.random() * (unit.damage[1] - unit.damage[0]));
            const reducedDamage = Math.floor(damage * Math.pow(0.7, target.defense));
            target.hp -= reducedDamage;
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†ÙˆØ§Ø± Ø³Ù„Ø§Ù…Øª
            if (target.hp < 0) target.hp = 0;
            document.querySelector(`.country[data-player-id="${target.id}"] .hp-fill`).style.width = `${target.hp}%`;
            
            addMessage(`ğŸ’¥ ${target.name} ${reducedDamage} Ø¢Ø³ÛŒØ¨ Ø¯ÛŒØ¯! (â¤ï¸${target.hp})`);
            
            if (target.hp <= 0) {
              addMessage(`ğŸ’€ ${target.name} Ø§Ø² Ø¨Ø§Ø²ÛŒ Ø­Ø°Ù Ø´Ø¯!`);
              checkGameEnd();
            }
          }
          
          // Ø§ÛŒØ¬Ø§Ø¯ Ø§Ù†ÙØ¬Ø§Ø±
          createExplosion(
            missile.toX, 
            missile.toY, 
            missile.type
          );
        }
      });
      
      // Ø­Ø°Ù Ù…ÙˆØ´Ú©â€ŒÙ‡Ø§ÛŒ Ù…Ù†ÙØ¬Ø± Ø´Ø¯Ù‡
      missiles = missiles.filter(m => !m.exploded || m.progress < 1);
      
      // Ù†ÙˆØ¨Øª Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
      if (!isPlayerTurn && gameMode === 'single') {
        aiTurn();
      }
      
      requestAnimationFrame(gameLoop);
    }
    
    // --- Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ ---
    function checkGameEnd() {
      const alivePlayers = Object.values(players).filter(p => p.hp > 0);
      
      if (alivePlayers.length === 1) {
        const winner = alivePlayers[0];
        document.getElementById('gameResult').textContent = winner.id === localPlayer.id ? 
          "Ù¾ÛŒØ±ÙˆØ²ÛŒ!" : "Ø´Ú©Ø³Øª!";
        document.getElementById('gameSummary').textContent = winner.id === localPlayer.id ?
          `Ø´Ù…Ø§ Ø¬Ù‡Ø§Ù† Ø±Ø§ ÙØªØ­ Ú©Ø±Ø¯ÛŒØ¯! ğŸ‰` :
          `${winner.name} Ø¬Ù‡Ø§Ù† Ø±Ø§ ÙØªØ­ Ú©Ø±Ø¯!`;
        document.getElementById('gameOver').style.display = 'flex';
      }
    }
    
    // --- Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ù†Ù‚Ø´Ù‡ ---
    worldMap.addEventListener('mousedown', (e) => {
      isDragging = true;
      lastX = e.clientX;
      lastY = e.clientY;
      e.preventDefault();
    });
    
    window.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      
      const dx = e.clientX - lastX;
      const dy = e.clientY - lastY;
      
      mapOffsetX += dx;
      mapOffsetY += dy;
      
      // Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø­Ø±Ú©Øª Ù†Ù‚Ø´Ù‡
      const maxOffset = 500;
      mapOffsetX = Math.max(-maxOffset, Math.min(maxOffset, mapOffsetX));
      mapOffsetY = Math.max(-maxOffset, Math.min(maxOffset, mapOffsetY));
      
      worldMap.style.transform = `translate(${mapOffsetX}px, ${mapOffsetY}px)`;
      lastX = e.clientX;
      lastY = e.clientY;
    });
    
    window.addEventListener('mouseup', () => {
      isDragging = false;
    });
    
    // Ú©Ù†ØªØ±Ù„ Ù„Ù…Ø³ÛŒ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„
    worldMap.addEventListener('touchstart', (e) => {
      isDragging = true;
      lastX = e.touches[0].clientX;
      lastY = e.touches[0].clientY;
      e.preventDefault();
    });
    
    window.addEventListener('touchmove', (e) => {
      if (!isDragging) return;
      
      const dx = e.touches[0].clientX - lastX;
      const dy = e.touches[0].clientY - lastY;
      
      mapOffsetX += dx;
      mapOffsetY += dy;
      
      const maxOffset = 500;
      mapOffsetX = Math.max(-maxOffset, Math.min(maxOffset, mapOffsetX));
      mapOffsetY = Math.max(-maxOffset, Math.min(maxOffset, mapOffsetY));
      
      worldMap.style.transform = `translate(${mapOffsetX}px, ${mapOffsetY}px)`;
      lastX = e.touches[0].clientX;
      lastY = e.touches[0].clientY;
      e.preventDefault();
    });
    
    window.addEventListener('touchend', () => {
      isDragging = false;
    });
    
    // Ú†Øª
    document.getElementById('chatInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        const input = document.getElementById('chatInput');
        if (input.value.trim()) {
          addMessage(`${localPlayer.name}: ${input.value}`);
          input.value = '';
        }
      }
    });
    
    // Ø¯Ú©Ù…Ù‡ Ù¾Ø§ÛŒØ§Ù† Ù†ÙˆØ¨Øª
    document.getElementById('endTurnBtn').addEventListener('click', endTurn);
  </script>
</body>
</html>